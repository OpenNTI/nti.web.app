@mixin meta-row {
    .meta {
        @include menu-label-text-treatment;
        font-size: 12px;
        font-weight: bold;
        white-space: nowrap;
        .name {
            color: #3fb3f6;
        }

        .controls {
            position: absolute;
            right: 0;
            top: 0;
            //background: blue;

            @include like-and-favorite;
        }
    }
}

@mixin note-editor {
	.editor {
		&.active {
			display:  block;
		}

		&.x-repaint{
			background: #ffffff;
		}

		@include animate(fadeIn,0.5s);
		display: none;
		overflow: hidden;
		min-width: 320px;
		min-height: 100px;

		.action {
			width: 24px;
			height: 24px;
			cursor: pointer;
			display: inline-block;
			color: #767676;
		}

		.main {
			background: #ffffff;
			padding: 0 13px;
			.toolbar {
				position: relative;
				overflow: hidden;
				border-bottom: 1px solid #dcdcdc;
				.left .action {float: left;}
				.right .action {float: right;}

				.action {
					width: 20px;
					height: 32px;
					line-height: 32px;

					&.bold {
						background: url(../images/tools/bold-icon.png) 4px 11px no-repeat;
						margin-right: 5px;
					}
					&.italic {
						background: url(../images/tools/italic-icon.png) 6px 11px no-repeat;
						margin-right: 6px;
					}
					&.underline {
						background: url(../images/tools/underline-icon.png) 4px 11px no-repeat;
					}
					&.share {
						width: auto;
						white-space: nowrap;
						background:{
							image: url(../images/tools/share.png), url(../images/tools/share-drop-arrow.png);
							position: 4px 8px, right 15px;
							repeat: no-repeat;
						};
						text-align: center;
						padding: 0 12px 0 25px;
						margin: 0 5px 0 0;
					}
				}

			}


			.content {
				&, * {
					@include allow-select;
				}
				white-space: pre;
				padding: 2px 0 0 0;
				color: #757474;
				font: italic 14px 'Droid Serif';
				overflow: auto;
				min-height: 50px;
				margin-bottom: 46px;
				max-height: 200px;

				img.wb-thumbnail {
					height: auto;
					max-height: 450px;
					width: 100%;//100% of width of container
					display: block;
					clear: both;
					overflow: hidden;
					background-position: 0 0;
					background-repeat: no-repeat;
					background-size: 100%;
				}
			}
		}
		.footer {
			position: absolute;
			bottom: 0;
			left: 0; right: 0;
			height: 45px;
			white-space: nowrap;

			border-top: 1px solid #dcdcdc;
			.left .action {float: left;}
			.right .action {float: right;}

			.action {
				height: 45px;
				width: 45px;
				line-height: 45px;
				font-size: 14px;
				text-align: center;
				color: #757474;
				margin: -1px;

				&.whiteboard {
					background: url(../images/whiteboard/icon.png) 12px 12px no-repeat;
				}

				&.cancel {
					width: 85px;
				}

				&.save {
					width: 95px;
					line-height: 44px;
					font-weight: bold;
					font-style: italic;
					color: #ffffff;
					background: #3fb3f6 url(../images/notes/comment-icon-white.png) 15px 8px no-repeat;
					border: 1px solid #39a1dd;
					padding: 0 0 0 24px;
				}
			}
		}
	}
}


@mixin reply-options {
	.reply-options {
		color: #757474;

		.reply, .chat, .more {
			display: inline-block;
			font-weight: 700;
			font-size: 12px;
			line-height: 32px;
			height: 32px;
			margin-right: 30px;
			cursor: pointer;

			opacity: 0.75;
			&:hover {
				opacity: 1;
			}
		}

		.reply {
			padding-left: 24px;
			background: url(../images/reply.png) 0 8px no-repeat;
		}

		.chat {
			padding-left: 28px;
			background: url(../images/start-chat.png) 0 8px no-repeat;
		}

		.more {
			position: relative;
			margin-right: 0;
			width: 32px;
			overflow: hidden;
			background: url(../images/more-options.png) -27px center no-repeat;
			border: 1px solid rgba(0,0,0,0);
			border-radius: 2px;

			&.active {
				border-color: #dcdcdc;
				background-color: #ffffff;
				background-position-x: 5px;
				box-shadow: 1px 1px 2px 0 rgba(0,0,0,0.09);

				ol {
					display: block;
				}
			}
			
			ol {
				&::before{
					position: absolute;
					width: 30px;
					height: 2px;
					background: white;
					top: -1px;
					left: 0;
					z-index: 10;
					content: ' ';
					overflow: hidden;
				}
				font-size: 14px;
				font-weight: normal;
				line-height: 27px;
				background: #ffffff;
				border: 1px solid #dcdcdc;
				box-shadow: 1px 1px 2px 0 rgba(0,0,0,0.09);
				display: none;
				position: fixed;
				margin: -8px 0 0 -1px;
				padding: 5px 0 10px 0;
                z-index: 9999;

				li {
					&:hover { background-color: #efefef; &::after { background-position-x: -20px; } }
					&::after {
						content: ' ';
						width: 18px;
						height: 18px;
						background: url(../images/options-menu-sprite.png) 0 0 no-repeat;
						position: absolute;
						top: 5px;
						left: 10px;
					}
					cursor: pointer;
					position: relative;
					padding: 0 10px 0 37px;

					&.share::after { background-position-y: 0; }
					&.flag::after { background-position-y: -18px; }
					&.add-contact::after { background-position-y: -36px; }
					&.follow::after { background-position-y: -54px; }
					&.block::after { background-position-y: -72px; }
					&.delete::after { background-position-y: -100px; }
				}
			}
		}
	}
}


.note-gutter {

	position: absolute;
	top: 0;
	left: 0;
	//border-right: 1px solid #eee;

	.note-here-control-box {
		//$t: top 0s, opacity 0.1s;
		//@include animate(fadeIn,0.1s);
		//@include experimental(transition, $t);

		cursor: text;
		position: absolute;
		left: 0;
		height: 26px;
		border: none;
		margin: 0 5px 0 15px;
		padding: 0;
		opacity: 1;
		display: block;

		&.note-overlay-hidden{
			display: none;
			//opacity: 0;
		}

		.bottom-border {
			overflow: hidden;
			background: none;
			border: 1px solid #e4e4e4;
			border-top-width: 0;
			margin: 0;
			padding: 0;
			height: 4px;
			position: absolute;
			bottom: 0;
			left: 0;
			right: 33px;
		}

		@include note-editor;
		.editor {
			//instance specific style
			background: #ffffff;
			border: 1px solid #dcdcdc;
			position: absolute;
			z-index: 999;

			top: -30px;
			left: -10px;
			right: 0;
			min-height: 210px;
		}

		.entry {
			&.active {
				textarea, .clear, .save {
					display: block;
				}
				.shadow-text{
					display: none;
				}
			}

			textarea {
				display: none;

				font: italic 14px 'Droid Serif';
				color: #757474;
				border: none;
				background: transparent;
				padding: 0 0 0 4px;
				margin: 0;
				resize: none;
				bottom: -2px;
				right: 55px;
				position: absolute;
				left: 0;
				height: 22px;
			}

			.clear {
				display: none;

				cursor: pointer;
				position: absolute;
				bottom: 4px; right: 38px;
				width: 16px; height: 16px;
				background: url(../images/tools/clear-line.png) 0 0 no-repeat;
				opacity: 0.6;
				&:hover{
					opacity: 1;
				}
			}
			.save {
				display: none;

				cursor: pointer;
				position: absolute;
				top: 0; right: 0;
				background: url(../images/notes/comment-icon-small-active.png) 0 0 no-repeat;
				width: 30px;
				height: 27px;
			}

			.shadow-text {
				color: #c4c4c4;
				position: absolute;
				padding: 0 4px;
				font: italic 14px 'Droid Serif';
				margin: 0;
				bottom: 4px;
			}
		}

	}
}



.note-gutter-widget {

	&.multi {
		background-size: cover;
        overflow: visible;
        position: relative;
		height: 30px;
		width: 30px;

        .bubble {
            display: none;
            position: absolute;
            overflow: hidden;
            bottom: 46px;
            left: -175px;
            max-width: 430px;
            min-width: 250px;
            max-height: 250px;
            padding: 15px 13px 20px 13px;
            background: #ffffff;
            border: 1px solid #dcdcdc;
            border-radius: 3px;
            box-shadow: 1px 1px 2px 0 rgba(0, 0, 0, 0.1);

            @include meta-row;
            .meta {
                font-size: 10px;
            }

            .text {
                overflow: hidden;
                text-overflow: ellipsis;
                color: #757474;
                font: 14px/22px 'Droid Serif' normal;
            }
        }

        &::after {
             content: url(../images/notes/bubble-tip.png);
             display: none;
             position: absolute;
             top: -18px;
             left: -14px;
             width: 34px;
             height: 15px;
        }


        &:hover {
            box-shadow:
              inset 0 0 0 2px #ffffff,
              0 2px 5px 2px rgba(0,0,0,.3);
            z-index: 10;
            .bubble {
                display: block;
            }
            &::after {
                display: block;
            }
        }
	}

	&.single {
		position: relative;
		//top: -5px;

        //default turn these off
        .separator, .time, .respond, .controls {
            display: none;
        }

		.name {
			@include menu-label-text-treatment;
			color: #3fb3f6;
		}

		.text {
			text-rendering: optimizeLegibility;//fallback
			text-rendering: geometricPrecision;

			&::before{
				content: '"';
			}
			&::after{
				content: '"';
			}
			font: italic 12px 'Droid Serif';
			color: #494949;
			overflow: hidden;
			white-space: nowrap;
		}
		.mask {
			position: absolute;
			top: 0;
			left: 0;
			bottom: 0;
			right: 0;

			$experimental-support-for-svg: true;
			@include background-image(linear-gradient(left,  rgba(255,255,255,0) 0%,rgba(255,255,255,0) 78%,rgba(255,255,255,1) 100%));
		}

		.respond .more ol {
			z-index: 9999 !important;
		}

        &:hover {
            border: 1px solid #dcdcdc;
            box-shadow: inset 0 1px 0 0 #ffffff,
                1px 1px 2px 0 rgba(0, 0, 0, 0.1);
            background: #f8f8f8;
            padding: 10px;
            margin: -11px 0 0 -11px;
            min-width: 270px;
			z-index: 999;

            .mask {
                display: none;
            }

			.separator, .time, {
				@include menu-label-text-treatment;
				display: inline;
			}
			.controls{
				display: block;
			}

            @include meta-row;

            .respond {
            	position: relative;
                display: block;
          		overflow: hidden;
          		margin: 12px 0 0 0;

          		@include reply-options;
          	}
        }
	}
}


.note-window {
	@extend .nti-window;
	@include reset-window-border-radius(3px);
	box-shadow: 0 0 50px 5px rgba(0, 0, 0, 0.3);

	&,.nti-window-header{
		background-color: #ffffff;
	}

	.nti-window-header{
		cursor: default;
		.header-body {
			span {
			}
		}
	}

    .note-responses{
        padding-bottom: 45px;
    }

	.carousel {
		background: #e6e6e6;
		border: 1px solid #c5c5c5;
		border-left-width: 0;
		border-right-width: 0;
	}

    .note-reply,
	.main-view {
		border: 0px solid #f1f1f1;
		border-bottom-width: 1px;
		padding: 16px 27px 20px 27px;
		&.editor-active, &.hover {
			box-shadow: inset 0 1px 0 0 #ffffff;
			background-color: #f8f8f8;
			.respond .reply-options{ visibility: visible; }
		}

        @include meta-row;
		.meta {
			font-size: 12px;
		}

		.context {
			background: #ffffff;
			box-shadow: 0 0 5px 8px #ffffff;
			border-radius: 3px;

			text-rendering: optimizeLegibility;//fallback
			text-rendering: geometricPrecision;

			span{
				color: #494949;
				padding: 2px 0;
				font-size: 14px;
				line-height: 32px;
				white-space: pre-wrap;

				word-wrap: break-word;

				-webkit-hyphens: auto;
				-moz-hyphens: auto;
				-ms-hyphens: auto;
				hyphens: auto;

				&.highlight {
					color: #136ea5;
					background: #e1f4fe;
					.tip { @include highlight-tip; }
				}
			}

			margin: 15px 20px 25px;
		}

		.body {
			color: #757474;
			font: 16px/24px 'Droid Serif' normal;
		}

		&.editor-active .respond{
            display: block;
			.reply-options{display: none;}
			.editor { display: block; }
		}

		.respond {
			position: relative;
			overflow: hidden;
			margin: 12px 0 0 0;

			@include reply-options;
			.reply-options {
				visibility: hidden;
			}

			@include note-editor;
			.editor {
				.main{
					border: 1px solid #dcdcdc;
					border-bottom-width: 0;
				}
				.footer {
					.action {
						&.whiteboard {
							background-position-x: 2px;
						}
					}
				}
			}
		}
	}

    .note-reply {
        &.first{
            background-image: url(../images/reply-arrow.png);
            background-position: 18px 15px;
            background-repeat: no-repeat;
        }
        position: relative;
        padding-left: 30px;
        &.hover {
            .meta .controls {
                display: block;
            }
            .respond {
     			display: block;
            }
        }
        .respond {
   			display: none;
        }
        .meta {
            font-size: 10px;
            .controls {
                display: none;
            }
        }
        .body {
            font-size: 14px;
            line-height: default;
        }
    }

    .note-reply-container {
        .note-reply-container {
            .note-reply {
                padding-left: 60px;
                background-position-x: 48px;
            }
            .note-reply-container {
                .note-reply.first {
                    background-image: none;
                }
            }
        }
    }
}
